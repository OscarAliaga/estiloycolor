{% extends 'base.html' %}
{% block title %}{{ _('Portafolio') }}{% endblock %}

{% block content %}
<section id="portafolio" class="portfolio-section">
  <div class="portfolio-hero-content">
    <h2 class="portfolio-hero-title">{{ _('Portafolio') }}</h2>
    <p class="portfolio-hero-subtitle">
      {{ _('Descubre historias reales de transformaci√≥n y conexi√≥n con la imagen personal.') }}
    </p>
  </div>

<div class="section-content">
  <div class="portfolio-wrapper">
    <div class="portfolio-grid">

    <!-- === Portfolio Card con slider === -->
    <div class="portfolio-card">
      <div class="portfolio-card-text">
        <h3>{{ _('Alison: asesor√≠a integral de imagen para descubrir su estilo natural que le permite diferenciarse.') }}</h3>
        <p>{{ _('Trabajamos juntas en definir su estilo natural para expresar confianza, armon√≠a y autenticidad.') }}</p>
      </div>

      <div class="ba-container">
        <div class="reveal-slider">
          <span class="ba-label ba-label-before">{{ _('Antes') }}</span>
          <span class="ba-label ba-label-after">{{ _('Despu√©s') }}</span>

          <!-- Imagen base: ANTES -->
          <img src="{{ url_for('static', filename='img/p1_antes.png') }}" class="slider-base" alt="{{ _('Antes') }}">

          <!-- Imagen superpuesta: DESPU√âS -->
          <div class="ba-overlay">
            <img src="{{ url_for('static', filename='img/p1_despues.png') }}" alt="{{ _('Despu√©s') }}">
          </div>

          <div class="ba-handle"></div>
          <div class="slider-tooltip">ü°Ü {{ _('Mueve la barra para ver el resultado') }}</div>
        </div>
      </div>
    </div>

  <!-- === Portfolio Card Carousel === -->
<div class="portfolio-card">
  <div class="portfolio-card-text">
    <h3>{{ _('Trinidad: colorimetr√≠a y visajismo para conocer los colores que resaltan su belleza natural') }}</h3>
    <p>{{ _('Descubri√≥ que los colores del espectro verano fr√≠o realzan su belleza.') }}</p>
  </div>

  <!-- Carousel espec√≠fico para esta tarjeta -->
  <div class="carousel-wrapper fade-in-up" id="carouselTrinidad">
    <div class="pause-indicator" id="pauseTrinidad">‚è∏ {{ _('Pausado') }}</div>

    <!-- Flechas -->
    <button class="carousel-nav left" id="prevTrinidad">‚ùÆ</button>
    <button class="carousel-nav right" id="nextTrinidad">‚ùØ</button>

    <!-- Im√°genes -->
    <div class="carousel-slide" id="slideTrinidad">
      <div class="carousel-item"><img src="{{ url_for('static', filename='img/trini1.jpg') }}" alt="Trinidad 1"></div>
      <div class="carousel-item"><img src="{{ url_for('static', filename='img/trini2.jpg') }}" alt="Trinidad 2"></div>
      <div class="carousel-item"><img src="{{ url_for('static', filename='img/trini3.jpg') }}" alt="Trinidad 3"></div>
      <div class="carousel-item"><img src="{{ url_for('static', filename='img/trini4.jpg') }}" alt="Trinidad 4"></div>
      <div class="carousel-item"><img src="{{ url_for('static', filename='img/trinidad5.jpg') }}" alt="Trinidad 5"></div>
    </div>
  </div>

  <!-- Texto sincronizado -->
  <div class="carousel-text" id="textTrinidad"></div>
</div>

  </div> <!-- cierre .portfolio-grid -->
</div> <!-- cierre .section-content -->

    <!-- Textos de cada slide carousel -->
<script id="textosTrinidad" type="application/json">
[
  "{{ _('Primer diagn√≥stico de colorimetr√≠a') }}",
  "{{ _('An√°lisis de visagismo: forma del rostro y armon√≠a') }}",
  "{{ _('Selecci√≥n de paleta de colores personalizada') }}",
  "{{ _('Prueba de colores cerca del rostro') }}",
  "{{ _('Resultados: paleta verano fr√≠o y estilo rom√°ntico') }}"
]
</script>

    <!-- === Call to action === -->
    <div class="cta-container">
      <a href="{{ url_for('contact', lang=get_locale()) }}" class="hero-button">
        {{ _('Agenda tu asesor√≠a personalizada') }}
      </a>
    </div>
  </div>
</section>

<!-- ‚úÖ JavaScript Reveal Slider -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const sliders = document.querySelectorAll(".reveal-slider");

  sliders.forEach(slider => {
    const overlay = slider.querySelector(".ba-overlay");
    const handle = slider.querySelector(".ba-handle");

    if (!overlay || !handle) return;

    let isDragging = false;

    setTimeout(() => {
  let percent = 50;
  let direction = 1;
  const overlay = slider.querySelector(".ba-overlay");
  const handle = slider.querySelector(".ba-handle");
  handle.classList.add("pulsing");


  const anim = setInterval(() => {
    percent += direction * 2;
    if (percent >= 70) direction = -1;
    if (percent <= 0) {
      clearInterval(anim);
      percent = 0; // Finaliza mostrando solo "Antes"
    }

    overlay.style.width = `${percent}%`;
    handle.style.left = `${percent}%`;
    updateActiveLabel(percent);
  }, 20);
}, 600);

  // Agrega clase para activar animaci√≥n CSS
slider.classList.add("animate-init");

// Desactiva la clase luego de que termine la animaci√≥n (para evitar conflictos)
setTimeout(() => {
  slider.classList.remove("animate-init");

  // Asegura estado final (por si el navegador no aplic√≥ 100% del keyframe)
  overlay.style.width = "0%";
  handle.style.left = "0%";
  updateActiveLabel(0);
}, 2900); // un poco m√°s que la duraci√≥n de la animaci√≥n


    const updateSlider = (x) => {
      const rect = slider.getBoundingClientRect();
      let offset = x - rect.left;
const min =0; // m√≠nimo 10px desde el borde izquierdo
const max = rect.width - 10; // m√°ximo 10px antes del borde derecho
offset = Math.max(min, Math.min(offset, max));

      const percent = (offset / rect.width) * 100;
      overlay.style.width = `${percent}%`;
      handle.style.left = `${percent}%`;
      updateActiveLabel(percent);
    };

    // ‚úÖ Agrega referencia a los labels
const labelBefore = slider.querySelector(".ba-label-before");
const labelAfter = slider.querySelector(".ba-label-after");

// ‚úÖ Funci√≥n para resaltar el label activo seg√∫n posici√≥n
function updateActiveLabel(percent) {
  if (percent < 20) {
    labelBefore.classList.add("active");
    labelAfter.classList.remove("active");
  } else if (percent > 80) {
    labelAfter.classList.add("active");
    labelBefore.classList.remove("active");
  } else {
    labelBefore.classList.remove("active");
    labelAfter.classList.remove("active");
  }
}

    const startDrag = () => isDragging = true;
    const stopDrag = () => isDragging = false;

    handle.addEventListener("mousedown", startDrag);
    handle.addEventListener("touchstart", startDrag);

    window.addEventListener("mouseup", stopDrag);
    window.addEventListener("touchend", stopDrag);

    window.addEventListener("mousemove", e => {
      if (isDragging) updateSlider(e.pageX);
    });

    window.addEventListener("touchmove", e => {
      if (isDragging) updateSlider(e.touches[0].pageX);
    });

    // Posici√≥n inicial
    overlay.style.width = "50%";
    handle.style.left = "50%";
    // Animaci√≥n inicial autom√°tica
setTimeout(() => {
  let percent = 50;
  let direction = 1;

  const anim = setInterval(() => {
    percent += direction * 1;

    if (percent >= 70) direction = -1;

    if (percent <= 0) {
      clearInterval(anim);

      // ‚úÖ Forzar la posici√≥n final al 0%
      overlay.style.width = "0%";
      handle.style.left = "0%";
      updateActiveLabel(0);
      return;
    }

    overlay.style.width = `${percent}%`;
    handle.style.left = `${percent}%`;
    updateActiveLabel(percent);
  }, 25);
}, 600); // Espera inicial antes de empezar la animaci√≥n

      const stopPulse = () => {
  handle.classList.remove("pulsing");
  window.removeEventListener("mousemove", stopPulse);
  window.removeEventListener("touchmove", stopPulse);
};

window.addEventListener("mousemove", stopPulse);
window.addEventListener("touchmove", stopPulse);


  });
});
</script>

    <script>
  function iniciarCarouselPersonalizado(wrapperId, slideId, textId, prevId, nextId, pauseId, jsonId) {
    const textos = JSON.parse(document.getElementById(jsonId).textContent.trim());
    const slide = document.getElementById(slideId);
    const textEl = document.getElementById(textId);
    const wrapper = document.getElementById(wrapperId);
    const pauseIndicator = document.getElementById(pauseId);
    let currentIndex = 0;
    let intervalId = null;
    const totalSlides = textos.length;

    function updateCarousel() {
      slide.style.transform = `translateX(${-100 * currentIndex}%)`;
      textEl.classList.add('fade-out');
      setTimeout(() => {
        textEl.textContent = `‚Äú${textos[currentIndex]}‚Äù`;
        textEl.classList.remove('fade-out');
      }, 400);
    }

    function startCarousel() {
      stopCarousel();
      intervalId = setInterval(() => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateCarousel();
      }, 4000);
    }

    function stopCarousel() {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
      }
    }

    document.getElementById(prevId).addEventListener('click', () => {
      stopCarousel();
      currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
      updateCarousel();
    });

    document.getElementById(nextId).addEventListener('click', () => {
      stopCarousel();
      currentIndex = (currentIndex + 1) % totalSlides;
      updateCarousel();
    });

    wrapper.addEventListener('mouseenter', () => {
      stopCarousel();
      pauseIndicator.style.opacity = '1';
    });

    wrapper.addEventListener('mouseleave', () => {
      startCarousel();
      pauseIndicator.style.opacity = '0';
    });

    updateCarousel();
    startCarousel();
  }

  // Inicializa el carousel de Trinidad
  iniciarCarouselPersonalizado(
    'carouselTrinidad', 'slideTrinidad', 'textTrinidad',
    'prevTrinidad', 'nextTrinidad', 'pauseTrinidad', 'textosTrinidad'
  );
</script>

{% endblock %}
